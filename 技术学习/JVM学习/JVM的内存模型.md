# JVM的内存模型

### 概述

Java虚拟机在执行java程序的过程中，会把它所管理的内存划分为若干个不同的数据区域。这些区域都有各自的用途，以及创建和销毁的时间，有的区域随着虚拟机进程的启动而存在，有些区域则依赖用户线程的启动和结束而建立和销毁。

java虚拟机所管理的内存包括以下几个运行时数据区域：

- 方法区（包括运行时常量池）
- Java堆
- 虚拟机栈
- 本地方法栈
- 程序计数器

其中属于所有线程共享的数据区是：方法区、堆；

属于线程隔离（线程安全）的数据区是：虚拟机栈、本地方法区、程序计数器。

### Java堆

对大多数应用来说，Java堆是JVM管理的内存中最大的一块。在虚拟机启动时创建，唯一目的就是存放对象实例，几乎所有的对象实例都在这里分配内存。

Java堆是垃圾收集器管理的主要区域，因此很多时候也叫GC堆。从内存回收的角度看，由于现在收集器基本都是采用分代收集算法，所以Java堆还可以细分为：新生代和老年代。

如果在java堆中没有完成实例分配，并且堆也无法拓展时，将会抛出OutOfMemoryError异常。

1. Java进程启动时，虚拟机就会分配一块初始堆空间，可以使用参数-Xms指定这块空间的大小；
2. 如果初始堆空间耗尽，虚拟机会对堆空间继续扩展，其扩展上限为最大堆空间，最大堆空间可以使用参数-Xmx指定；

### 方法区

方法区用于存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据。虽然java虚拟机规范将方法去描述为一个逻辑部分，但是它却有一个别名叫做Non-Heap（非堆），目的是与java堆区分开来。















> 参考：《深入理解Java虚拟机》— 周志明