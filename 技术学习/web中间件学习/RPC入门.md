# RPC入门

## PRC简介

远程过程调用，Remote Procedure Call。它是一种通过网络向远程计算机请求服务，而不需要了解底层网络技术的协议。通俗的说就是两台服务器A，B不在同一个节点，A服务器上部署的应用想调用B服务器提供的方法/函数，由于不在一个内存空间，不能直接调用（如果在同一个内存空间就可以通过指针/地址调用了），需要通过网络来表达调用的语义和传达调用的数据。比较成熟的方案有RMI、WebService等。

和RESTful一样，是目前比较主流的URL链接风格。

RPC的可以基于HTTP和TCP协议实现。把RPC比喻成交通工具，那么HTTP和TCP就相当于汽车。

**基于HTTP协议的RPC**：可以使用JSON或XML格式的响应数据，而JSON和XML作为通用的格式标准，开源的解析工具已经相当成熟，在其上进行二次开发屏蔽了很多底层繁琐的细节，非常便捷和简单。

**基于TCP协议的RPC**：由于处于协议栈的下层，能够更灵活地对协议字段进行定制，**减少网络传输字节数**，降低网络开销，提升性能，实现更大的吞吐量和并发数。但是需要更多地关注底层复杂的细节，实现的代价更高，且由于所定义协议自身的局限性，难以得到平台厂商和开源社区的支持，较难实现跨平台的调用。

综合来看，基于HTTP协议的RPC比基于TCP协议的RPC更具有优势。

### RPC的优势

- 单台服务器的处理能力受硬件成本的限制，不可能无限地提升。PRC将原来的本地调用转变为调用远端服务器上的方法，给系统的处理能力和吞吐量带来了近似于无限制提升的可能。这是分布式计算的基础。

- RPC框架一般使用长链接，不必每次通信都要3次握手，减少网络开销
- RPC框架一般都有注册中心，有丰富的监控管理
- 发布、下线接口、动态扩展等，对调用方来说是无感知、统一化的操作
- 协议私密，安全性较高
- rpc 协议更简单内容更小，效率更高
- 服务化架构、服务化治理，RPC框架是一个强力的支撑

### RPC的工作原理

1. 调用客户端句柄；执行传送参数
2. 调用本地系统内核发送网络消息
3. 消息传送到远程主机
4. 服务器句柄得到消息并取得参数
5. 执行远程过程
6. 执行的过程将结果返回服务器句柄 
7. 服务器句柄返回结果，调用远程系统内核
8. 消息传回本地主机
9. 客户句柄由内核接收消息
10. 客户接收句柄返回的数据





> 参考：
>
> https://www.zhihu.com/question/25536695
>
> [百度百科](https://baike.baidu.com/item/%E8%BF%9C%E7%A8%8B%E8%BF%87%E7%A8%8B%E8%B0%83%E7%94%A8%E5%8D%8F%E8%AE%AE/6893245?fromtitle=RPC&fromid=609861&fr=aladdin)
>
> https://segmentfault.com/a/1190000004978353