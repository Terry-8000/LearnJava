# BES架构学习 

一个好的，面向互联网海量高并发服务的系统架构，主要有5个核心的关注点：

1. 性能
2. 可用性
3. 伸缩性
4. 可拓展性 
5. 安全

## 分布式服务访问框架

这里使用的是DSF，业界比较著名的有Dubbo，其实原理都一样，大致分为4个角色：

1. **服务注册中心：**负责服务注册，服务发布，服务路由；
2. **服务提供方：**向服务中心注册，发布自己的服务；
3. **服务消费方：**订阅服务中心发布的服务，在服务中心notify服务之后，绑定并调用服务；
4. **服务监控方：**主要监控服务的调用情况。

DSF这个分布式服务调用框架中核心的调用路由，节点信息都保存在zookeeper上。

## API

我们的套件在DSF分布式服务调用框架上发布的所有对外服务接口，都可以通过UEE的gateway（网关，又称网间连接器、协议转换器）转化成标准的http restful服务(表征性状态转移[^1]是分布式应用服务器集群的一个要求，即服务的幂等性[^2]要求)。

## BDF

Business Development Framework，业务开发框架（JavaEE框架），也就是元数据引擎，提供了ORM（对象关系映射），OXM（XML对象映射），DI（依赖注入）等能力，还有BPM（业务流程管理），Microflow能力，终极目标是实现DDD（设计驱动开发）。

## DDS

分布式数据访问框架，业内著名的开源框架：阿里的Cobra。

当数据得到千万级别后，需要通过水平分表拆分为N个结构一样的表。这个时候就需要分布式数据访问框架了，提供的功能主要是：SQL执行计划，SQL执行，SQL结果汇聚等。

## NOSQL

非关系型数据库，有三种：key/value类型，比如Redis；文档类型，比如MongoDB；基于列类型，比如HBase。

## 分布式缓存

使用的是Redis，业界著名的还有Memcached，大都是基于一致性hash算法来实现分布式缓存内容命中。（可以看下一致性hash环算法https://blog.csdn.net/cywosp/article/details/23397179）

## 运维服务

ITPass提供：自动安装，升级，灰度发布，系统监控（负载，业务并发量，Tips（每秒事务量），吞吐量，时延等等），故障定位（提供服务调用链方便故障定位）。

## 负载均衡

#### 1. Radware

Radware提供硬件的负载均衡，能够实现传输层（IP+端口）级别的负载均衡。

负载均衡常用算法：

- 轮询：挨个来；
- 加权轮询：有一定权重的挨个来；
- 随机：按概率来说长期运行时平均的；
- 最少使用：分配给最少使用的；
- IP粘滞：同样的请求客户端IP，分配给最近最后依次请求的服务器。

#### 2. Nginx

反向代理服务器，接收网络上的请求然后再转发给内部网络上的服务器，在这里主要是应用层级别的负载均衡。

#### 3. varnish

与nginx仪器使用，起到了对服务器静态资源的缓存作用，比如一个静态页面请求到了nginx，nginx根据它自己的策略将次请求分发给varlish，从而直接返回静态资源，这样就极大的减轻了应用服务器集群的压力。

#### 4. zookeeper

Zookeeper类似于一棵节点树，当服务提供者启动时，将服务器的名称、地址以节点的信息添加到配置中心，而服务消费中通过服务器名称以及配置中心来获得需要调用的服务节点下的服务地址，再利用负载均衡算法选取其中的某一台服务器进行调用。

## jetMQ

基于RocketMQ封装的jetMQ。

## vSearch

搜索引擎。









[^1]: 表征性状态转移就是Rest(Representational State Transfer)，[参考](https://www.cnblogs.com/liuning8023/archive/2012/07/12/2587878.html)
[^2]: 幂等性是指一次和多次请求某一个资源应该具有同样的作用，[参考](https://www.cnblogs.com/weidagang2046/archive/2011/06/04/2063696.html)